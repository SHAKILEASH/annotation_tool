<!DOCTYPE html>
<html>
    <head>
        <title>Annotation tool - Developement | Adam - Mitsu - Keerthi</title>
        <!--script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script-->
        <link rel="icon" href="http://marmoset.brainarchitecture.org/wp-content/uploads/2016/02/logo.png" type="image/png">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <script src="js/konva.js" type="text/javascript"></script>

        <link rel ="stylesheet" type ="text/css" href = "style/style.css" />
        <link href="style/dashboard.css" rel="stylesheet"/>
        <link href="app/app.css" rel="stylesheet"/>
        <link href="app/vendor.css" rel="stylesheet"/>
        <link href="style/icon.css" rel="stylesheet"/>
        <link href="style/fontawesome.css" rel="stylesheet"/>
        <link href="style/solid.css" rel="stylesheet"/>
        <link href="//cdn.rawgit.com/noelboss/featherlight/1.7.13/release/featherlight.min.css" type="text/css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- <script src="js/jquery.min.js" type="text/javascript"></script> -->
        <script src="js/jquery-ui.min.js" type="text/javascript"></script>
        <link href="style/jquery-ui.css" rel="stylesheet"/>
    	  
        <link rel="stylesheet" type="text/css" href="style/evol-colorpicker.min.css"/>
        <link href="style/bootstrap.min.css" rel="stylesheet"/>
        <link href="style/dropdowntree.css" rel="stylesheet"/>
        
        <script src="js/evol-colorpicker.min.js" type="text/javascript"></script>
        <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
        <script src="js/app_v2.js" type="text/javascript"></script>
        <script src="js/control.js" type="text/javascript"></script>
        <script src="js/popper.min.js" type="text/javascript"></script>
        <script src="js/bootstrap.min.js" type="text/javascript"></script>

        <!-- include turf for geojson output -->
        <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
        
        <!-- include openlayers -->
        <link rel="stylesheet" href="style/ol.css" type="text/css">
        <script src="js/ol-4.6.4.js" type="text/javascript"></script>

        <!-- ion range slider -->
        <link href="style/ion-rangeSlider/ion.rangeSlider.css" rel="stylesheet"/>
        <link href="style/ion-rangeSlider/ion.rangeSlider.skinFlat.css" rel="stylesheet"/>
        <script src="js/ion-rangeSlider/ion.rangeSlider.min.js" type="text/javascript"></script>
        <script src="//cdn.rawgit.com/noelboss/featherlight/1.7.13/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
    </head>
    <body>

      <!-- main annotation  -->
      <div class="scene" style="width: calc(80%);">

          <!-- header -->
          <div class="headbar">
            <!-- header left group -->
             <div class="left-group">
                <div class="images-navigator" style="">
                   <div class="inline-block">
                    <a id="btn_section_left" class="btn el-tooltip">
                      <i class="icon-chevron-left" style="position: absolute;margin-top: 2px;margin-left: -5px;"></i>
                    </a>
                   </div>
                   <div class="inline-block progress-wrapper">
                      <div class="progress-line"><b style="width: 0%;"></b></div>
                      <b id='header_info_brainname_section' class="image-name el-tooltip">
                      Brain PMD940_0180
                      </b> 
                      <div class="info">
                        <span class="titles el-tooltip">
                          <a class="project-title">annotation
                          </a> 
                          <i class="icon-chevron-small-right chevron"></i>
                          <span id="tile-number" class="dataset-title">000</span>
                        </span>
                      </div>
                   </div>
                   <div class="inline-block">
                    <a id="btn_section_right" class="btn el-tooltip">
                      <i class="icon-chevron-right" style="position: absolute;margin-top: 2px;margin-left: -5px;"></i>
                    </a>
                  </div>
                   <!---->
                   <div class="el-loading-mask" style="display: none;">
                      <div class="el-loading-spinner">
                         <svg viewBox="25 25 50 50" class="circular">
                            <circle cx="50" cy="50" r="20" fill="none" class="path"></circle>
                         </svg>
                         <!---->
                      </div>
                   </div>
                </div>
             </div>
             <!-- header middle group -->
             <div class="navigator-wrapper">
                <div class="tool-options">
                   <div class="dropdown" style="margin-top: 10px">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownClasses" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Annotation Classes
                      </button>
                      <ul id="annotated_class" class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
                          <li class="dropdown-submenu">
                            <a  class="dropdown-item" tabindex="-1" href="#">neurites</a>
                            <ul class="dropdown-menu">
                              <li class="dropdown-submenu">
                                <a class="dropdown-item" href="#">axons</a>
                                <ul class="dropdown-menu">
                                    <li class="dropdown-item"><a href="#">passing fiber</a></li>
                                    <li class="dropdown-item"><a href="#">axon fiber</a></li>
                                    <li class="dropdown-item"><a href="#">axon unidentifiable</a></li>
                                </ul>
                                <a class="dropdown-item" href="#">dendrites</a>
                                <a class="dropdown-item" href="#">neurties unidentifiable</a>
                              </li>
                            </ul>
                          </li>
                          <li class="dropdown-submenu">
                            <a class="dropdown-item" href="#">injection site</a>
                            <ul class="dropdown-menu">
                              <li class="dropdown-submenu">
                                <a class="dropdown-item" href="#">injection soma</a>
                                <a class="dropdown-item" href="#">injection area</a>
                              </li>
                            </ul>
                          </li>
                          <li class="dropdown-submenu">
                            <a class="dropdown-item" href="#">others</a>
                            <ul class="dropdown-menu">
                              <li class="dropdown-submenu">
                                <a class="dropdown-item" href="#">autofluorescence</a>
                                <a class="dropdown-item" href="#">artifact</a>
                              </li>
                            </ul>
                          </li>
                        </ul>
                   </div>
                   <div class="divider"></div>
                   <a id="undo_draw" class="btn">
                       <i class="zmdi zmdi-undo"></i><div>undo</div>
                   </a>
                   <a id="redo_draw" class="btn">
                       <i class="zmdi zmdi-wrap-text"></i><div>redo</div>
                   </a>
                   <a class="btn">
                       <i class="zmdi zmdi-spinner"></i><div>load</div>
                   </a>
                   <a id="savebutton" class="btn">
                       <i class="zmdi zmdi-save"></i><div>save</div>
                   </a>
                   <a class="btn">
                       <i class="zmdi zmdi-download"></i><div>export</div>
                   </a>

                   <div class="divider"></div>

                   <div id="controlTool" class="toolBitmapOptions tool-options" style="margin-top: 8px;">
                      <button class="el-tooltip tool-button active" id="pointer_active">
                         <!----> <!----> <i class="icon-plus"></i> <!---->
                      </button>
                      <button class="el-tooltip tool-button" id="pixel_active">
                         <!----> <!----> <i class="icon-round-brush"></i> <!---->
                      </button>
                      <button class="el-tooltip tool-button" id="erase_active">
                         <!----> <!----> <i class="icon-eraser"></i> <!---->
                      </button>

                      <button class="el-tooltip tool-button disabled" style="top: 2px;"> 
                        <span class="svg-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 23 23" fill="">
                            <path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17">
                            </path>
                          </svg>
                        </span>
                      </button>
                      <button class="el-tooltip tool-button" id="fillcolor_active">
                         <!----> <!----> <i class="zmdi zmdi-format-color-fill drawing-color-change"></i> <!---->
                      </button>
                      <!-- //hide for future uses
                      <button class="el-tooltip tool-button" id="crop_active">
                         <i class="zmdi zmdi-crop"></i>
                      </button>
                      <button class="el-tooltip tool-button" id="align_active">
                         <i class="icon-align-bottom"></i>
                      </button>
                      -->
                      <div class="dropdown" style="margin-top: 2px;">         
                          <button id="selected-class" type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown"> 
                              pixel
                          </button> 
                            
                          <div id="brushsize_pixel" class="dropdown-menu"> 
                              <a class="dropdown-item" href="#" data-value="1">1 pixel</a>
                              <a class="dropdown-item" href="#" data-value="9">Small</a>
                              <a class="dropdown-item" href="#" data-value="25">Medium</a> 
                              <a class="dropdown-item" href="#" data-value="49">Large</a>
                          </div> 
                      </div>                      
                      <div class="magnify_style" style="margin-left: 30px; margin-top: 10px;">
                        <p style="position: absolute; font-size: 80%; font-weight: 400; margin-left: 60px;">Magnify (x<label id="zoomlabel">1</label>)</p>
                        <input style="margin-top: -6px; margin-left: 15px;" type="range" min="0.5" max="8" step="0.5" class="slider2" id="myRange"/>
                      </div>
                   </div>
                   <div class="divider"></div>
                   <a id="setting_draw" class="btn">
                       <i class="zmdi zmdi-settings"></i><div>setting</div>
                   </a>
                </div>
             </div>
        </div>
          <!-- end of header -->

          <!-- 
          <div class="btn-toolbar mb-2 mb-md-0" style="padding-bottom:10px">        
                  <div class="btn-group mr-2">
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_linestring">Curve</label></div>
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_polygon">Polygon</label></div>
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="raster_pixel" checked>Pixel</label></div>
                      <div class="radio"><label><input type="radio" name="drawingtype" value="pointer" checked>Pointer</label></div>
                  </div>
                   <div class="btn-group mr-2">
                          <button id="savebutton" class="btn btn-sm btn-outline-secondary">Save</button>
                          <button id="exportbutton" class="btn btn-sm btn-outline-secondary">Export
                          </button>
                  </div> 
                 <div class="btn-group mr-2">
                  <span id="modelabel" class="label" style="padding-left:10px" >Brush size</span>
                    <select id="BrushSize">
                      <option value="1">1 pixel</option>
                      <option value="9" selected="selected">small</option>
                      <option value="25">medium</option>
                      <option value="49">large</option>
                    </select>
                  </div>
                  <label for="picker">Color</label>
                  <input id="picker" style="width:100px"/>
          
          </div>
          -->
        
          <div id="dynamitc_select" class="row">
            <div id="stage-parent" class="col-md-10" style="">
              <div id="image_loading_selected" class="lds-dual-ring"></div>
              <div id="container">
              </div>
              <div class="scene-controls">
                <a id="apply_all_tiles_section" class="btn-round mt">
                  <i class="text" style="font-size: 10px">Apply</i>
                </a> 
                <a id="reset_all_tiles_section" class="btn-round mt">
                  <i class="text" style="font-size: 10px">Reset</i>
                </a> 
                <a class="btn-round">
                  <i class="icon-minus"></i>
                </a> 
                <span>
                  <a id="st_on_dynamtic" class="btn-round mt btn-options">
                    <i class="icon-switch"></i>
                  </a>
                </span>
              </div>
              <!-- <div id="showing_range" class="el-popover" style="width: 420px;transform-origin: right center;z-index: 2035;position: fixed;bottom: 15px;right: 80px;" x-placement="left"> -->
              <div id="showing_range" class="toggle_range" style="width: 270px; position: fixed;bottom: 15px;right: 90px;" x-placement="left">  
                <div id="rangeslider">
                  <div class="red_slider">
                    <div class="red_slider_note">Red:</div>
                    <input type="text" class="red-range-slider" name="red_range" value="" /><br/>
                  </div>
                  <div class="blue_slider">
                    <div class="blue_slider_note">Blue:</div>
                    <input type="text" class="blue-range-slider" name="blue_range" value="" /><br/>
                  </div>
                  <div class="green_slider">
                    <div class="green_slider_note">Green:</div>
                    <input type="text" class="green-range-slider" name="green_range" value="" /><br/>
                  </div>
                   <div class="gamma_slider">
                    <div class="gamma_slider_note">Gamma:</div>
                    <input type="text" class="gamma-range-slider" name="gamma_range" value="" /><br/>
                  </div>
                  <div class="opacity_slider">
                     <div class="opacity_slider_note">Mask opacity:</div>
                     <input type="text" class="opacity-range-slider" name="opacity_range" value="" /><br/>
                   </div>  
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- end main annotation -->

        <!-- sidebar tile images -->
        <!-- panel-top -->
        <div class="sidebar" style="width: calc(20%);">
           <div class="split split">
              <div id="panel-top" class="panel" style="height: calc(50% - 2px);">
                 <div class="disabled-overlay" style="display: none;"></div>
                 <a class="panel-title">
                    <span class="title-text"><i class="panel-icon icon-images"></i>
                    Brain Tiles
                    </span> 
                    <i id="total_tiles" class="numbers">
                       <span>
                          total: 33
                       </span>
                    </i>
                    <div class="panel-tabs"></div>
                    <div class="actions">
                    </div>
                </a> 

                 <div class="panel-body">
                    <div class="el-scrollbar">
                       <div class="el-scrollbar__wrap" style="margin-bottom: -15px; margin-right: -15px; height: 600px;">
                          <div class="el-scrollbar__view" style="position: relative;">
                             <div class="images-list" style="">
                                <div class="table-list">
                                   <!----> <!----> 
                                   <table id='listTableTiles'>
                                      <tbody id='listOfTiles'> 
                                      </tbody>
                                   </table>
                                   <!---->
                                </div>
                                <div class="el-loading-mask" style="display: none;">
                                   <div class="el-loading-spinner">
                                      <svg viewBox="25 25 50 50" class="circular">
                                         <circle cx="50" cy="50" r="20" fill="none" class="path"></circle>
                                      </svg>
                                      <!---->
                                   </div>
                                </div>
                             </div>
                             <div class="resize-triggers">
                                <div class="expand-trigger">
                                   <div style="width: 317px; height: 299px;"></div>
                                </div>
                                <div class="contract-trigger"></div>
                             </div>
                          </div>
                       </div>
                       <div class="el-scrollbar__bar is-horizontal">
                          <div class="el-scrollbar__thumb" style="transform: translateX(0%);"></div>
                       </div>
                       <div class="el-scrollbar__bar is-vertical">
                          <div class="el-scrollbar__thumb" style="transform: translateY(0%); height: 62.0833%;"></div>
                       </div>
                    </div>
                 </div>
              </div>
              
              <!-- end panel-top -->
              <!-- panel-middle -->
              <div id="gutter-vertical-control-top" class="gutter gutter-vertical" style="height: 4px;"></div>
              <div id="panel-middle" class="panel" style="height: calc(20% - 2px);">
                <div class="disabled-overlay" style="display: none;"></div>
                <a class="panel-title">
                    <span class="title-text"><i class="panel-icon icon-layers"></i>
                    Annotation Tracking (Objects)
                    </span> 
                    <i class="numbers">
                       <span>
                          01
                       </span>
                    </i>
                    <div class="panel-tabs"></div>
                    <div class="actions">
                    </div>
                </a>
                <div class="panel-body">
                  <div class="el-scrollbar">
                     <div class="el-scrollbar__wrap" style="margin-bottom: -15px; margin-right: -15px; height: 600px;">
                        <div class="el-scrollbar__view" style="position: relative;">
                           <div class="figures-list">
                              <div class="table-list">
                                 <table id='list-body'>
                                    <tbody id='listOfAnnotation'> 
                                    </tbody>
                                 </table>
                                 <!---->
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div> 
              </div>
              <!-- end panel-middle -->
              <!-- panel-bottom -->
              <div id="gutter-vertical-control-bt" class="gutter gutter-vertical" style="height: 4px;"></div>
              <div id="panel-bottom" class="panel" style="height: calc(30% - 2px);">
                <a class="panel-title">
                    <span class="title-text"><i class="panel-icon icon-section-1"></i>
                    Full Section
                    </span> 
                    <i id="full_image_file_name" class="numbers">
                    </i>
                </a>
                <div id="map" class="map"></div> 
                <div class="cell_annotation"><button id="cell_annotation_marking" class="cell_annotation-tabs" type="button">M</button></div>
                <!-- <div class="cell_annotation"><button id="cell_annotation_marking" class="cell_annotation-tabs" type="button">M</button></div> -->
              </div>
              <!-- end panel-bottom -->
        </div>
      </div>
      <!-- end sidebar control -->

      <script type="text/javascript">
        var section_image_size;
        var fullurl;
        var brain_id = getUrlVars()["brain_id"];
        var type = getUrlVars()["type"];
        var current_section = Number(getUrlVars()["section"]);

        if(brain_id == undefined){
          $.getJSON('http://braincircuits.org/cgi-bin/iipsrv.fcgi?IIIF=/PITT001/Marmo_7NA_7_layers_1um_spacing.jp2/info.json', function(data) {
              width = `${data.width}`
              height = `${data.height}`
              let dect = [width, height];
              section_image_size = dect;
              generateTileTable(dect);
          });
        }else{
          generatesectiontils(brain_id, current_section);
        }

        mouseclick();
        //var nagImagesize = $(window).width() * 0.20 - 3;
  
        selectedToolBtn();
        selectedpixel(); // Does it need be here? Mitsu
        selectedclasses(); // Does it need be here? Mitsu

        var currentimgid = null;
        $(document).on("click", "#listTableTiles tbody tr", function() {
            imageid = $(this).closest('tr').attr('id');
            if(imageid!=currentimgid) {
               currentimgid=imageid;
               $('#' + imageid).click(function() {
                  $(this).addClass('active');
                  $(this).siblings().removeClass('active');
                  res = imageid.split('-');
                  selectedTile(res[1],section_image_size, imagecurrentPath, current_gamma);
               });
            }
        });
        
        // if(brain_id == undefined){
        //   var imageaddress = "http://braincircuits.org/cgi-bin/iipsrv.fcgi?FIF=/PITT001/Marmo_7NA_7_layers_1um_spacing.jp2&WID="+nagImagesize + "&QLT=130&CNT=1&CVT=jpeg";
        //   $('#navImageSection').attr("src",imageaddress);
        // }

      </script>
      
      <script type="text/javascript">
        $(document).ready(function() {
          setInitValue();
          initializeStage();
          setMouseEvt();
          setElementAct();
          beforeAndafterSection(current_section);
          clickrangecontrol();
          initRangeSlider();
          applyRangesControl();
          // fitStageIntoParentContainer();
          // adapt the stage on any window resize
          // window.addEventListener('resize', fitStageIntoParentContainer);        
        });
      </script>
    </body>
</html>