function create_slider(fid, pid){
    var $red_range = $("#red_range_slider"),
        $red_result = $("#red_result_slider");
    var $blue_range = $("#blue_range_slider"),
        $blue_result = $("#blue_result_slider");            
    var $green_range = $("#green_range_slider"),
        $green_result = $("#green_result_slider");  
	var $gamma_range = $("#gamma_range_slider"),
        $gamma_result = $("#gamma_result_slider");  
        
    var red_track = function () {
        var $this = $(this),
            value = $this.prop("value").split(";");

        $red_result.html(value[0] + "to" + value[1]);
    };

    var blue_track = function () {
        var $this = $(this),
            value = $this.prop("value").split(";");

        $blue_result.html(value[0] + "-" + value[1]);
    };

    var green_track = function () {
        var $this = $(this),
            value = $this.prop("value").split(";");

        $green_result.html(value[0] + "-" + value[1]);
    };
    
    var gamma_track = function () {
        var $this = $(this),
            value = $this.prop("value").split(";");

        $gamma_result.html(value[0]);
    };
    
    var red_data_from = blue_data_from = green_data_from = 0;
    var red_data_to = blue_data_to = green_data_to = 255;
    var init_to_color = 255;
    var gamma_data = 1;
	
    var colorRanges;
    
    if(app.meta.levels != '8'){
       colorRanges = [0,4096];

    }else{
       colorRanges = [0,255];
    }

    
    $red_range.ionRangeSlider({
        type: "double",
        min: colorRanges[0],
        max: colorRanges[1],
        from: colorRanges[0],
        to: init_to_color,
        grid: true,
        onFinish: function (data) {
            red_data_from = data.from;
            red_data_to = data.to;
            app.rft_id = 'http://mitra.brain.riken.jp/wp-content/uploads/'+fid+'/'+pid + '&svc.crange='+ 
                          red_data_from + '-'+ red_data_to +','+ blue_data_from + '-'+ blue_data_to + ',' + green_data_from + '-'+ green_data_to +'&svc.gamma=' + gamma_data;
            console.info(app.rft_id);
            refresh_layer(app.rft_id);
        },
    });

    $blue_range.ionRangeSlider({
        type: "double",
        min: colorRanges[0],
        max: colorRanges[1],
        from: colorRanges[0],
        to: init_to_color,
        grid: true,
        onFinish: function (data) {
            blue_data_from = data.from;
            blue_data_to = data.to;
            app.rft_id = 'http://mitra.brain.riken.jp/wp-content/uploads/'+fid+'/'+pid + '&svc.crange='+ 
                          red_data_from + '-'+ red_data_to +','+ blue_data_from + '-'+ blue_data_to + ',' + green_data_from + '-'+ green_data_to +'&svc.gamma=' + gamma_data;
            console.info(app.rft_id);
            refresh_layer(app.rft_id);
        },
    });

    $green_range.ionRangeSlider({
        type: "double",
        min: colorRanges[0],
        max: colorRanges[1],
        from: colorRanges[0],
        to: init_to_color,
        grid: true,
        onFinish: function (data) {
            green_data_from = data.from;
            green_data_to = data.to;
            app.rft_id = 'http://mitra.brain.riken.jp/wp-content/uploads/'+fid+'/'+pid + '&svc.crange='+ 
                          red_data_from + '-'+ red_data_to +','+ blue_data_from + '-'+ blue_data_to + ',' + green_data_from + '-'+ green_data_to +'&svc.gamma=' + gamma_data;
            console.info(app.rft_id);
            refresh_layer(app.rft_id);
        },
    });
    
    $gamma_range.ionRangeSlider({
        min: 0.1,
        max: 2,
        from: 1,
        grid: true,
        step: 0.1,
        onFinish: function (data) {
            gamma_data = data.from;
            app.rft_id = 'http://mitra.brain.riken.jp/wp-content/uploads/'+fid+'/'+pid + '&svc.crange='+ 
                          red_data_from + '-'+ red_data_to +','+ blue_data_from + '-'+ blue_data_to + ',' + green_data_from + '-'+ green_data_to +'&svc.gamma=' + gamma_data;
            console.info(app.rft_id);
            refresh_layer(app.rft_id);
        },
    });
    

    $red_range.on("change", red_track);
    $blue_range.on("change", blue_track);
    $green_range.on("change", green_track);
    $gamma_range.on("change", gamma_track);
}

function refresh_layer(rft_id){
    $('.map').empty();
    $('.zonemap').empty();
    app.rft_id = rft_id;
    if(window.location.pathname == "/openlayers/ol5.html"){
        reloadJs("/openlayers/scripts/viewer_ol5.js"); 

    }else{
        reloadJs("/openlayers/scripts/viewer.js"); 
    }

 //    var new_jsrc = new ol.source.Djatoka({
 //        url: app.url,
 //        image: rft_id
 //    });

 //    var new_colorLayer = new ol.layer.Tile({
 //        source: new_jsrc,
 //        projection: app.proj
 //    });
    

	// new_colorLayer.setSource(new_jsrc);
 //    //new_colorLayer.setMap();
    
 //    var layers = [
 //            new_colorLayer
 //        ];
 //    layers.push(new_colorLayer);

 //    app.map = new ol.Map({
 //        target: 'map',
 //        layers: layers,
 //        view: app.map_view,
 //        pixelRatio: 1,
 //        controls: ol.control.defaults({
 //            attribution: false
 //        }).extend(app.custom_controls),
 //        logo: false
 //    });
	// app.map.addLayer(new_colorLayer);
    /*
	var tempSrc = new ol.source.Vector({wrapX: false, useSpatialIndex: false});
    var overlay_layer = new ol.layer.Vector({
        map: app.map,
        source: tempSrc
    });
    app.map.addLayer(overlay_layer);
    app.map.removeLayer(overlay_layer);
*/
}

function reloadJs(src) {
    src = $('script[src$="' + src + '"]').attr("src");
    $('script[src$="' + src + '"]').remove();
    $('<script/>').attr('src', src).appendTo('body');
}

function addSliderDiv(){
	if(slice_type== 'F'){
		var sliderDiv='<div>Dynamic Range:</div>'+
					  '<div class="red_slider">'+
	        			'<div class="red_slider_note">Red:</div>' + 
	        			'<input id="red_range_slider" />' +
	        			'<div class="red_slider_right">' +
	            			//'<b id="red_result_slider" class="result_slider"></b>' +
		        		'</div>'+
	    			  '</div>' +
	    			  '<div class="blue_slider">' +
	        		  	'<div class="blue_slider_note">Green:</div>' +
	        			'<input id="blue_range_slider" />' +
	        			'<div class="blue_slider_right">' +
	           			    //'<b id="blue_result_slider" class="result_slider"></b>' +
	        			'</div>' +
	    			   '</div>' +
	    			   '<div class="green_slider">' +
	        			'<div class="green_slider_note">Blue:</div>' +
	        			'<input id="green_range_slider" />' +
	        			'<div class="green_slider_right">' +
	            			//'<b id="green_result_slider" class="result_slider"></b>' +
	        			'</div>' +
	    			   '</div>'+
	    			   '<div class="gamma_slider">' +
	        			'<div class="gamma_slider_note">Gamma:</div>' +
	        			'<input id="gamma_range_slider" />' +
	        			'<div class="gamma_slider_right">' +
	            			//'<b id="gamma_result_slider" class="result_slider"></b>' +
	        			'</div>' +
	    			   '</div>';
	 }else{
	 	var sliderDiv='<div class="gamma_slider">' +
	        			'<div class="gamma_slider_note">Contrast:</div>' +
	        			'<input id="gamma_range_slider" />' +
	        			'<div class="gamma_slider_right">' +
	            			//'<b id="gamma_result_slider" class="result_slider"></b>' +
	        			'</div>' +
	    			   '</div>';
	 }
	 
    // var isMobile = ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/));
    // if(isMobile){
    // 	$('#rangeslider_inside_tab').append(sliderDiv);
    // }else{
    // 	//document.getElementById("rangeslider").style.display = "none";
    // 	$('#rangeslider').append(sliderDiv);
    // }
    $('#rangeslider').append(sliderDiv);
}

function addCellCountingDiv(){
	var CellDiv='<div class="cell-counting">'+
			    	'<label>Cell Counting (FB):</label>'+
			    	'<div class="onoffswitch">'+
					    '<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="cellcount_onoffswitch" checked>'+
					    '<label class="onoffswitch-label" for="cellcount_onoffswitch">'+
					        '<span class="onoffswitch-inner"></span>'+
					        '<span class="onoffswitch-switch"></span>'+
					    '</label>'+
					'</div>'+
			        '<form class="form-inline">'+
			            '<label><p id="brain_name"></p></label><br/>'+
			            '<label>Mark Type:&nbsp</label>'+
			            '<select class="selectCellBox" id="mtype">'+
			            '<option value="Polygon">Polygon</option>'+
			            '<option value="Box">Box</option>'+
			            '<option value="All">All</option>'+
			            '<option value="None" selected>None</option>'+
			          '</select>'+
			        '</form>'+
			        /* '<button id="jsonbutton">Count Cells</button>'+ */
			        '<div id="popup"></div>'+
			        '<p class="lorem"></p>'+
			        '<div id="rangeslider_inside_tab"></div>'+
			    '</div>';

	$('#cell_counting').append(CellDiv);
	
	if(slice_type != 'F'){
		$('#cell_counting').hide();
	}
}

function addHisOverlay(){
    var HisDiv='<div class="his-overlay">'+
                    '<label>Histologal Overlay:</label>'+
                    '<div class="onoffswitch1">'+
                        '<input type="checkbox" name="onoffswitch1" class="onoffswitch-checkbox1" id="hisoverlay_onoffswitch" checked>'+
                        '<label class="onoffswitch-label1" for="hisoverlay_onoffswitch">'+
                            '<span class="onoffswitch-inner1"></span>'+
                            '<span class="onoffswitch-switch1"></span>'+
                        '</label>'+
                    '</div>'+
                '</div>';

    $('#his_overlay').append(HisDiv);
}
function addMetaDataDiv(){
    regquery = '{"brainno":'+ brain_id +',"label":"'+ slice_type +'","filelocation":"'+file_location+ '","brainname":"'+ slice_no + '"}';
    $.ajax({
        url:'/openlayers/getmeta.php',
        type: 'POST',
        //contentType:'application/json; charset = utf-8',
        data: {'qry' :regquery},
            success:function(result){
                $('#metadatainfo').append(result);         
        }
    });



}
function addBrainName(brain_name){
    $('#brain_name').empty();
    $('#brain_name').append('<p>'+brain_name+'</p>');

}
