<!DOCTYPE html>
<html>
<head>
    <title>Annotation tool - Developement</title>
    <!--script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script type="text/javascript" src="https://cdn.rawgit.com/konvajs/konva/0.9.5/konva.js"></script>
    <link rel = "stylesheet" type = "text/css" href = "style.css" />
    <link href="dashboard.css" rel="stylesheet"/>
<!-- 
    <script type="text/javascript" src="https://raw.githubusercontent.com/shiva16/konva/master/konva0.9.5.js"></script>
    <script type="text/javascript" src="https://raw.githubusercontent.com/shiva16/konva/master/ba_konva.js"></script> 
-->

   
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/solid.css" integrity="sha384-r/k8YTFqmlOaqRkZuSiE9trsrDXkh07mRaoGBMoDcmA58OHILZPsk29i2BsFng1B" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css" integrity="sha384-4aon80D8rXCGx9ayDt85LbyUHeMWd3UiBaWliBlJ53yzm9hqN21A+o1pqoyK04h+" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>

    <link id="jquiCSS" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" type="text/css" media="all">

    <!--link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css"/-->
    <link rel="stylesheet" type="text/css" href="evol-colorpicker.min.css"/>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script src="evol-colorpicker.min.js" type="text/javascript"></script>

</head>
<body>
    <header>
            <nav class="navbar navbar-expand-md navgar-dark fixed-top bg-dark">
                <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Annotation tool</a>
                <button class="navgar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>
                      </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link disabled" href="#">Disabled</a>
                        </li>
                      </ul>
                
                <input class="form-control col-sm-3 form-control-dark" type="text" placeholder="Search" aria-label="Search">
                <ul class="navbar-nav px-3">
                    <li class="nav-item text-nowrap">
                    <a class="nav-link" href="#">Sign out</a>
                    </li>
                </ul>
                </div>
            </nav> 
        </header>

        <main role="main" class="container-fluid" style="padding-top:60px">
              

        <div class="container-fluid">
            <div class="row">

                    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                            <div class="sidebar-sticky">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                <a class="nav-link active" href="#">
                                    <span data-feather="home"></span>
                                    My tiles ({{num}})
                                </a>
                                </li>
                                <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file"></span>
                                    Annotate <span class="sr-only">(current)</span>
                                </a>
                                </li>
                                <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="shopping-cart"></span>
                                    Review
                                </a>
                                </li>
                            </ul>
                
                            <!-- h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span>Saved reports</span>
                                <a class="d-flex align-items-center text-muted" href="#">
                                <span data-feather="plus-circle"></span>
                                </a>
                            </h6>
                            <ul class="nav flex-column mb-2">
                                <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Current month
                                </a>
                                </li>
                                <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Last quarter
                                </a>
                                </li>
                                
                            </ul-->
                            </div>
                        </nav>

                        
                    <div class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                        <h1 class="h2">Brain <span id="braindetails"></span> </h1>
                        <p style="background-color: antiquewhite">Region <span id="regdetails"></span> (1/8 mm)</p>
                        
                        <div class="btn-toolbar mb-2 mb-md-0" style="padding-bottom:10px">
                                
                                <div class="btn-group mr-2">
                                    <button id="undobutton" class="btn btn-sm btn-outline-secondary">Undo</button>
                                    <button id="redobutton" class="btn btn-sm btn-outline-secondary">Redo</button>
                                </div>
                                <div class="btm=group mr-2">
                                    <button id="loadbutton" class="btn btn-sm btn-outline-secondary">Load</button>
                                </div>
                                <!--button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                                    <span data-feather="calendar"></span>
                                    This week
                                </button-->
                                <div class="btn-group mr-2">
                                    <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_linestring">Curve</label></div>
                                    <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_polygon">Polygon</label></div>
                                    <div class="radio"><label><input type="radio" name="drawingtype" value="raster_pixel" checked>Pixel</label></div>
                                </div>
                                <div class="col-md-2">
                                    <span id="modelabel" class="label" style="padding-left:10px" >Erase</span>
                                    <label class="switch">
                                        <input type="checkbox" id="erase_check">
                                        <span class="slider"></span>
                                    </label>
                                </div>
        
                                <div class="btn-group mr-2">
                                        <button id="savebutton" class="btn btn-sm btn-outline-secondary">Save</button>
                                        <button id="exportbutton" class="btn btn-sm btn-outline-secondary">Export</button>
                                    </div>
                        </div>
                        <div class="row">
                            <div id="stage-parent" class="col-md-10" style="border:solid 1px;">
                                <div  id="container"></div>
                            </div>
                            <div class="col-md-2">
                                    <table>
                                            <tr><td></td><td> &nbsp;&nbsp;<a id="upbutton"><i class="fas fa-arrow-up"></i></a> </td><td></td></tr>
                                            <tr><td><a id="leftbutton"><i class="fas fa-arrow-left"></i></a> </td><td>&nbsp;&nbsp;<a id="centerbutton"><i class="fas fa-map-marker-alt"></i></a>&nbsp;</td><td>&nbsp;<a id="rightbutton"><i class="fas fa-arrow-right"></i></a> </td></tr>
                                            <tr><td></td><td> &nbsp;&nbsp;<a id="downbutton"><i class="fas fa-arrow-down"></i></a> </td><td></td></tr>
                                        </table>
                                        Magnify (x<label id="zoomlabel">1</label>)
                                        <input type="range" min="1" max="4" value="1" class="slider2" id="myRange"/>
                
                                    <form style="border:solid 1px;padding:5px">
                                            <h5>Add object</h5>
                                        
                                        <div class="form-group">
                                            <label for="objname">Label</label> 
                                            <input type="text" id="objname" class="form-control"/>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="picker">Color</label>
                                            <input id="picker" style="width:100px"/>
                                            <!--select id="picker" size=5>
                                                <option value="1" id="option-1">Red</option>
                                                <option value="2" id="option-2">Green</option>
                                                <option value="3" id="option-3">Meganta</option>
                                                <option value="4" id="option-4">Yellow</option>
                                                <option value="5" id="option-5">Gray</option>
                                                <option value="6" id="option-6">Aqua</option>
                                                <option value="7" id="option-7">Silver</option>
                                                <option value="8" id="option-8">Gold</option>
                                                <option value="9" id="option-9">White</option>
                                            </select-->
                                        </div>
                                        <button id="start">Start</button><button id="end">End</button>
                                    </form>
                            </div>
                        </div>

                    </div>

            </div>
        </div>
        </main>
    <script src="app.js">
        fitStageIntoParentContainer();
        // adapt the stage on any window resize
        window.addEventListener('resize', fitStageIntoParentContainer);        
    </script>
    
    <script>
        $(document).ready(function() {

            $('#picker').colorpicker({
                color:'#ff9800',
                initialHistory: ['#ff0000','#000000','red', 'purple']
            });
            
        // $('[name="picker"]').paletteColorPicker({
        //     colors: ['#D50000','#304FFE','#00B8D4','#69F0AE','#FFFF00','#F8BBD0'],
        //     clear_btn: null
        // });
        stage.add(layer);
        // stage.add(layer_vector);

        const nativeCtx = layer.getContext()._context;
        nativeCtx.webkitImageSmoothingEnabled = false;
        nativeCtx.mozImageSmoothingEnabled = false;
        nativeCtx.imageSmoothingEnabled = false;
        nativeCtx.msImageSmoothingEnabled = false;
        bgImage = new Image();
        xpix = 16000; // 16280.0 + 700;
        ypix = 7400 ; //11950.0 + 400;
        xpc = xpix / 24000.0;
        ypc = ypix / 18000.0;
        wpc = wid / 24000.0;
        hpc = hei / 18000.0;
        rgnstring = xpc + "," + ypc + "," + wpc + "," + hpc;
        //bgImage.src = "images/resolver_1020701_12800,16640,544,544.jpg";
        iipbase = "http://braincircuits.org/cgi-bin/iipsrv.fcgi?FIF=";
        // brainno = "PMD2055";
        seriesid = '4236';
        sectionid = '913380';

        apibase = "http://mitradevel.cshl.org/webtools/seriesbrowser";

        $.getJSON(apibase+'/getsectionjp2path/'+sectionid, function(data) {

            jp2filepath = data['jp2Path'];
            
            jp2pathdescribe(jp2filepath);

            bgImage.src =
                iipbase+jp2pathtranslate_(jp2filepath) +
                "&WID="+ wid +
                "&RGN=" + rgnstring +
                "&MINMAX=1:0,255&MINMAX=2:0,255&MINMAX=3:0,255&GAM=1&CVT=jpeg";

            $('#regdetails').html(''+xpix+','+ypix+'; '+wid+'x'+hei);
            bgImage.onload = function() {
                outimg = new Konva.Image({
                    x: 0,
                    y: 0,
                    width: wid,
                    height: hei,
                    image: bgImage,
                    draggable: false
                });
                layer.add(outimg);
                layer.draw();
                // layer_vector.draw();
            };


        });
    });

    </script>
</body>
</html>
