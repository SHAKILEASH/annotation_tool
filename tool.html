<!DOCTYPE html>
<html>
    <head>
        <title>Annotation tool - Developement</title>
        <!--script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script-->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="https://cdn.rawgit.com/konvajs/konva/0.9.5/konva.js"></script>
        <link rel = "stylesheet" type = "text/css" href = "style/style.css" />
        <link href="style/dashboard.css" rel="stylesheet"/>
        <link href="app/app.css" rel="stylesheet"/>
        <link href="app/vendor.css" rel="stylesheet"/>
        <link href="style/icon.css" rel="stylesheet"/>

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/solid.css" integrity="sha384-r/k8YTFqmlOaqRkZuSiE9trsrDXkh07mRaoGBMoDcmA58OHILZPsk29i2BsFng1B" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css" integrity="sha384-4aon80D8rXCGx9ayDt85LbyUHeMWd3UiBaWliBlJ53yzm9hqN21A+o1pqoyK04h+" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js" type="text/javascript"></script>
    	  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
        <link id="jquiCSS" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css" type="text/css" media="all">
        <link rel="stylesheet" type="text/css" href="style/evol-colorpicker.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="js/evol-colorpicker.min.js" type="text/javascript"></script>
        <script src="js/control.js" type="text/javascript"></script>
        <script type="text/javascript">
            var nagImagesize = $(window).width() * 0.20 - 3;
        </script>
    </head>
    <body>
      <!-- toolbar -->
      <div class="toolbar">
         <div class="btn-group">
            <button class="el-tooltip btn active">
               <!----> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M13,6V11H18V7.75L22.25,12L18,16.25V13H13V18H16.25L12,22.25L7.75,18H11V13H6V16.25L1.75,12L6,7.75V11H11V6H7.75L12,1.75L16.25,6H13Z"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <!----> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19C6.45,19 6,18.55 6,18V3C6,2.45 6.45,2 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <!----> <i class="zmdi zmdi-arrows"></i>
            </button>
            <button class="el-tooltip btn disabled">
               <!----> <i class="icon-price-tag"></i>
            </button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M12,20L7,22L12,11L17,22L12,20M8,2H16V5H22V7H16V10H8V7H2V5H8V2M10,4V8H14V4H10Z"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M2,4H8V6H16V4H22V10H20V14H22V20H16V18H8V20H2V14H4V10H2V4M16,10V8H8V10H6V14H8V16H16V14H18V10H16M4,6V8H6V6H4M18,6V8H20V6H18M4,16V18H6V16H4M18,16V18H20V16H18Z"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M16,2V8H17.08L14.95,13H14.26L12,9.97V5H6V11H6.91L4.88,16H2V22H8V16H7.04L9.07,11H10.27L12,13.32V19H18V13H17.12L19.25,8H22V2M18,4H20V6H18M8,7H10V9H8M14,15H16V17H14M4,18H6V20H4"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled"><span class="add-icon">+</span> <i class="icon-round-brush"></i></button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="32" viewBox="0 0 24 24" fill="">
                     <path d="M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"></path>
                  </svg>
               </span>
            </button>
            <button class="el-tooltip btn disabled">
               <span class="add-icon">+</span> 
               <span class="svg-icon">
                  <!--?xml version="1.0" standalone="no"?-->
                  <svg class="icon" height="512" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                     <path d="M384 128v256h31.146667l-168.106667 298.666667H85.333333v256h256v-85.333334h341.333334v85.333334h256v-256h-161.706667l-168.106667-298.666667H640V128m-170.666667 85.333333h85.333334v85.333334h-85.333334m42.666667 87.04l170.666667 303.36V768H341.333333v-78.933333M170.666667 768h85.333333v85.333333H170.666667m597.333333-85.333333h85.333333v85.333333h-85.333333" fill=""></path>
                  </svg>
               </span>
            </button>
         </div>
      </div>
      <!-- end toolbar -->


      <!-- main annotation  -->
      <div class="scene" style="width: calc(75% - 3px);">
          <h1 class="h2">Brain <span id="braindetails"></span> </h1>
          <p style="background-color: antiquewhite">Region <span id="regdetails"></span> (1/8 mm)</p>
          
          <div class="btn-toolbar mb-2 mb-md-0" style="padding-bottom:10px">
                  
                  <div class="btn-group mr-2">
                      <button id="undobutton" class="btn btn-sm btn-outline-secondary">Undo</button>
                      <button id="redobutton" class="btn btn-sm btn-outline-secondary">Redo</button>
                  </div>
                  <div class="btm=group mr-2">
                      <button id="loadbutton" class="btn btn-sm btn-outline-secondary">Load</button>
                  </div>
                  <!--button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                      <span data-feather="calendar"></span>
                      This week
                  </button-->
                  <div class="btn-group mr-2">
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_linestring">Curve</label></div>
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="vector_polygon">Polygon</label></div>
                      <div class="radio" style="padding-right:10px"><label><input type="radio" name="drawingtype" value="raster_pixel" checked>Pixel</label></div> <!-- Mitsu -->
                      <div class="radio"><label><input type="radio" name="drawingtype" value="pointer" checked>Pointer</label></div> <!-- Mitsu -->
                  </div>
                  <div class="col-md-2">
                      <span id="modelabel" class="label" style="padding-left:10px" >Erase</span>
                      <label class="switch">
                          <input type="checkbox" id="erase_check">
                          <span class="slider"></span>
                      </label>
                  </div>

                  <div class="btn-group mr-2">
                          <button id="savebutton" class="btn btn-sm btn-outline-secondary">Save</button>
                          <button id="exportbutton" class="btn btn-sm btn-outline-secondary">Export</button>
                      </div>
          </div>
          <div class="row">
              <div id="stage-parent" class="col-md-10" style="">
                  <div  id="container"></div>
              </div>
              <div class="col-md-2">
<!-- 				<table>
				<tr><td></td><td> &nbsp;&nbsp;<a id="upbutton"><i class="fas fa-arrow-up"></i></a> </td><td></td></tr>
				<tr><td><a id="leftbutton"><i class="fas fa-arrow-left"></i></a> </td><td>&nbsp;&nbsp;<a id="centerbutton"><i class="fas fa-map-marker-alt"></i></a>&nbsp;</td><td>&nbsp;<a id="rightbutton"><i class="fas fa-arrow-right"></i></a> </td></tr>
				<tr><td></td><td> &nbsp;&nbsp;<a id="downbutton"><i class="fas fa-arrow-down"></i></a> </td><td></td></tr>
				</table> -->
				<label>Magnify (x<label id="zoomlabel">1</label>)</label>
                <div>
                <input type="range" min="0.1" max="40" value="1" step="0.1" class="slider2" id="myRange"/>
  				</div>
				<form style="border:solid 1px;padding:5px">
				<h5>Add object</h5>
				<div class="form-group">
				<label for="objname">Label</label> 
				<input type="text" id="objname" class="form-control"/>
				</div>
				
				<div class="form-group">
				<label for="picker">Color</label>
				<input id="picker" style="width:100px"/>
				</div>
				<button id="start">Start</button><button id="end">End</button>
				</form>
              </div>
          </div>
        </div>

        <!-- end main annotation -->
        <!-- sidebar tile images -->
        <div class="sidebar" style="width: calc(20% - 3px);">
           <div class="split split">
              <div id="panel-top" class="panel" style="height: calc(60% - 2px);">
                 <div class="disabled-overlay" style="display: none;"></div>
                 <a class="panel-title">
                    <span class="title-text"><i class="panel-icon icon-images-1"></i>
                    Brain Tiles
                    </span> 
                    <i class="numbers">
                       <span>
                          total: 33
                       </span>
                    </i>
                    <div class="panel-tabs"></div>
                    <div class="actions">
                    </div>
                </a> 

                 <div class="panel-body">
                    <div class="el-scrollbar">
                       <div class="el-scrollbar__wrap" style="margin-bottom: -15px; margin-right: -15px; height: 600px;">
                          <div class="el-scrollbar__view" style="position: relative;">
                             <div class="images-list" style="">
                                <div class="table-list">
                                   <!----> <!----> 
                                   <table id='listTableTiles'>
                                      <tbody id='listOfTiles'> 
                                      </tbody>
                                   </table>
                                   <!---->
                                </div>
                                <div class="el-loading-mask" style="display: none;">
                                   <div class="el-loading-spinner">
                                      <svg viewBox="25 25 50 50" class="circular">
                                         <circle cx="50" cy="50" r="20" fill="none" class="path"></circle>
                                      </svg>
                                      <!---->
                                   </div>
                                </div>
                             </div>
                             <div class="resize-triggers">
                                <div class="expand-trigger">
                                   <div style="width: 317px; height: 299px;"></div>
                                </div>
                                <div class="contract-trigger"></div>
                             </div>
                          </div>
                       </div>
                       <div class="el-scrollbar__bar is-horizontal">
                          <div class="el-scrollbar__thumb" style="transform: translateX(0%);"></div>
                       </div>
                       <div class="el-scrollbar__bar is-vertical">
                          <div class="el-scrollbar__thumb" style="transform: translateY(0%); height: 62.0833%;"></div>
                       </div>
                    </div>
                 </div>
              </div>
              <div id="gutter-vertical-control" class="gutter gutter-vertical" style="height: 4px;"></div>
              <div id="panel-bottom" class="panel" style="height: calc(40% - 2px);">
                <div class="disabled-overlay" style="display: none;"></div>
                <a class="panel-title">
                    <span class="title-text"><i class="panel-icon icon-section-1"></i>
                    Full Section
                    </span> 
                    <i class="numbers">
                       <span>
                          01
                       </span>
                    </i>
                    <div class="panel-tabs"></div>
                    <div class="actions">
                    </div>
                </a> 
                <img id='navImageSection' class="width: calc(20% - 3px); width: calc(20% - 3px);" src="">
              <!----> <!----> <!----> <!---->
           </div>
        </div>
      </div>
      <!-- end sidebar control -->

      <script src="js/app.js">
          fitStageIntoParentContainer();
          // adapt the stage on any window resize
          window.addEventListener('resize', fitStageIntoParentContainer);        
      </script>

      <script type="text/javascript">
        mouseclick();
        generateTileTable();
        var imageaddress = "http://braincircuits.org/cgi-bin/iipsrv.fcgi?FIF=/PITT001/Marmo_7NA_7_layers_1um_spacing.jp2&WID="+nagImagesize + "&QLT=130&CNT=1&CVT=jpeg";
        $('#navImageSection').attr("src",imageaddress);
      </script>

      <script>
      $(document).ready(function() {
            $('#picker').colorpicker({
                color:'#ff9800',
                initialHistory: ['#ff0000','#000000','red', 'purple']
            });
            stage.add(layer);

            const nativeCtx = layer.getContext()._context;
            nativeCtx.webkitImageSmoothingEnabled = false;
            nativeCtx.mozImageSmoothingEnabled = false;
            nativeCtx.imageSmoothingEnabled = false;
            nativeCtx.msImageSmoothingEnabled = false;
            bgImage = new Image();
            xpix = 16000; // 16280.0 + 700;
            ypix = 7400 ; //11950.0 + 400;
            xpc = xpix / 24000.0;
            ypc = ypix / 18000.0;
            wpc = wid / 24000.0;
            hpc = hei / 18000.0;
            rgnstring = xpc + "," + ypc + "," + wpc + "," + hpc;
            //bgImage.src = "images/resolver_1020701_12800,16640,544,544.jpg";
            iipbase = "http://braincircuits.org/cgi-bin/iipsrv.fcgi?FIF=";
            // brainno = "PMD2055";
            seriesid = '3362';
            sectionid = '691261';

            apibase = "http://mitradevel.cshl.org/webtools/seriesbrowser";

            $.getJSON(apibase+'/getsectionjp2path/'+sectionid, function(data) {

                jp2filepath = data['jp2Path'];
                
                jp2pathdescribe(jp2filepath);

                bgImage.src =
                    iipbase+jp2pathtranslate_(jp2filepath) +
                    "&WID="+ wid +
                    "&RGN=" + rgnstring +
                    "&MINMAX=1:0,255&MINMAX=2:0,255&MINMAX=3:0,255&GAM=1&CVT=jpeg";

                $('#regdetails').html(''+xpix+','+ypix+'; '+wid+'x'+hei);
                bgImage.onload = function() {
                    outimg = new Konva.Image({
                        x: 0,
                        y: 0,
                        width: wid,
                        height: hei,
                        image: bgImage,
                        draggable: false
                    });
                    layer.add(outimg);
                    layer.draw();
                    // layer_vector.draw();
                };
            });
        });
      
        $(document).on("click", "#listTableTiles tbody tr", function() {
            imageid = $(this).closest('tr').attr('id');
            $('#' + imageid).click(function() {
               res = imageid.split('-');
               selectedTile(res[1]);
            });
        });
      </script>
    </body>
</html>